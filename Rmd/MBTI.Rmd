---
title: "MBTI dataset transformation and analysis"
author: "Vedran Moškov, Lucija Runjić, Borna Josipović, Lana Bartolović"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r setup, include=FALSE, warning=F}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(magrittr)
library(gridExtra)
library(nortest)
library(leaps)
```


```{r, echo=F}
rm(list = ls()) # uklanjanje svih varijabli iz okoline
```

```{r, echo=F}
source("../Rscripts/utils.R")
```

***

# Motivacija i opis problema

Istražujemo povezanost između osobnosti, dobivene kroz MBTI test, i fizičkih karakteristika poput držanja tijela, težine i visine. Kroz proučavanje pitanja kao što su "Kako tipovi ličnosti utječu na način držanja?" i "Postoje li razlike u tjelesnoj težini ili visini između različitih tipova ličnosti?" analizom ovih podataka, nastojimo bolje razumjeti veze između mentalnog i fizičkog aspekta individualnosti.

***

# Učitavanje i uređivanje podatkovnog skupa

## Učitavanje i proučavanje podatkovnog skupa 

Učitavamo podatkovni skup u varijablu "dataset".
```{r, message=F}
dataset <- read_csv("../data/MBTI.csv")
```

Proučavamo podatkovni skup kako bi ga znali urediti na način da nam je lakše raditi s njim kasnije.
```{r}
head(dataset)
tail(dataset)
glimpse(dataset)
```

## Uređivanje podataka podatkovnog skupa

Faktoriziramo određene stupce "SEX", "ACTIVITY LEVEL", "MBTI", "POSTURE"  kako bismo kasnije mogli lakše grupirati podatke i bolje ih analizirati
```{r}
dataset$SEX <- as.factor(dataset$SEX)
dataset$`ACTIVITY LEVEL` <- as.factor(dataset$`ACTIVITY LEVEL`)
dataset$`ACTIVITY LEVEL` <- factor(dataset$`ACTIVITY LEVEL`, levels = c("Low", "Moderate", "High"))
dataset$MBTI <- as.factor(dataset$MBTI)
dataset$POSTURE <- as.factor(dataset$POSTURE)
dataset$POSTURE <- factor(dataset$POSTURE, levels = c("A", "B", "C", "D"), 
                          labels = c("idealno", "kifoza/lordoza", "ravna leđa", "nagnuto"))
```

Uklonit ćemo prva dva stupca podatkovnog skupa obzirom da su jedinstveni identifikatori te nam ne pomažu u analizi.
```{r}
dataset$...1 <- NULL
dataset$`S No` <- NULL
```

Preimenovat ćemo stupce "ACTIVITY LEVEL", "PAIN 1", "PAIN 2", "PAIN 3" i "PAIN 4" radi jednostavnosti.
```{r}
colnames(dataset)[5] <- "ACTIVITY_LEVEL"
colnames(dataset)[6] <- "PAIN_1"
colnames(dataset)[7] <- "PAIN_2"
colnames(dataset)[8] <- "PAIN_3"
colnames(dataset)[9] <- "PAIN_4"
```

```{r}
dataset$HEIGHT <- round(dataset$HEIGHT * 2.54, 1)
dataset$WEIGHT <- round(dataset$WEIGHT * 0.45359237, 1)
```


Dodat ćemo novi stupac "GROUP" u kojem ćemo grupirati tipove osobnosti ovisno o boji kojoj pripadaju.
```{r}
dataset$GROUP <- as.factor(color(dataset$MBTI)) 
dataset$IS_ACTIVE <- as.factor(ifelse(dataset$ACTIVITY_LEVEL == "Low", "Inactive", "Active"))
dataset$HEIGHTgroup <- as.factor(height_category(dataset$HEIGHT))
dataset$HEIGHTgroup <- factor(dataset$HEIGHTgroup, levels = c("Short", "Medium height", "Tall"))
dataset$WEIGHTgroup <- as.factor(weight_category(dataset$WEIGHT))
dataset$WEIGHTgroup <- factor(dataset$WEIGHTgroup, levels = c("Light", "Medium weight", "Heavy"))
dataset$IE <- as.factor(substring(dataset$MBTI, 1, 1))
dataset$SN <- as.factor(substr(dataset$MBTI, 2, 2))
dataset$TF <- as.factor(substr(dataset$MBTI, 3, 3))
dataset$JP <- as.factor(substr(dataset$MBTI, 4, 4))
```


Ovako naš podatkovni skup izgleda nakon uređivanja njegovih podataka.
```{r}
head(dataset)
tail(dataset)
glimpse(dataset)
```


***
# Analiza podatkovnog skupa

## Veza između tipa ličnosti i načina držanja

U našem podatkovnom skupu imamo stupce "POSTURE" i "MBTI".

Stupac "POSTURE" poprima vrijednosti:

```{r}
ggplot(dataset, aes(x = POSTURE, fill = POSTURE)) +
  geom_bar() +
  scale_fill_ordinal() + 
  labs(x = "Posture", fill = "Posture", y = "Count")
```

Imamo 4 klase načina držanja.

Stupac "MBTI" poprima vrijednosti:
```{r}
ggplot(dataset, aes(x = MBTI, fill = MBTI)) + 
  geom_bar() + 
  scale_fill_ordinal() + 
  theme(axis.text.x = element_text(angle = 45)) + 
  labs(y = "Count")
```
```{r}
ggplot(dataset, aes(x = GROUP, fill = GROUP)) + 
  geom_bar() + 
  scale_fill_ordinal() + 
  labs(x = "Group", fill = "Group", y = "Count")
```

[Razlikujemo 16 vrsta tipova osobnosti](https://www.16personalities.com/personality-types).


Provest ćemo hi kvadrat test za kategorijske podatke.
Pretpostavljamo normalnost ?.
```{r}
contingency_table <- table(dataset$POSTURE, dataset$IE)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Ekstrovertnost imaju veze sa načinom držanja.


```{r}
contingency_table <- table(dataset$POSTURE, dataset$SN)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Raspoznavanje/intuicija nemaju veze sa načinom držanja.

```{r}
contingency_table <- table(dataset$POSTURE, dataset$TF)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Razmišljanje/osjećanje nemaju veze sa načinom držanja.

```{r}
contingency_table <- table(dataset$POSTURE, dataset$JP)
contingency_table
check_expected(contingency_table)
```

```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Produđivanje/opažanje ima veze sa načinom držanja



## Veza između fizičke aktivnosti i razine ekstrovertiranosti

Fizičku aktivnost nam predstavlja stupac "ACTIVITY_LEVEL"
```{r}
ggplot(dataset, aes(x = ACTIVITY_LEVEL, fill = ACTIVITY_LEVEL)) + 
  geom_bar() + 
  scale_fill_ordinal() + 
  labs(x = "Activity level", fill = "Activity level", y = "Count")
```
Razlikujemo 3 razine fizičke aktivnosti.

```{r}
ggplot(dataset, aes(x = E, fill = E>I)) + geom_bar() + 
  scale_fill_ordinal() + 
  labs(x = "Extroversion", fill = "Extrovert", y = "Count")
```
```{r}
contingency_table <- table(dataset$IS_ACTIVE, dataset$IE)
contingency_table
check_expected(contingency_table)
```
```{r, warning=F}
chisq <- chisq.test(contingency_table)
chisq
```




## Razlika u visini/težini obzirom na tip ličnosti

```{r}
ggplot(dataset, aes(x = dataset$HEIGHT, y = dataset$WEIGHT, color = dataset$GROUP)) + 
  geom_point() + 
  stat_smooth(method = lm, 
              inherit.aes = F, 
              aes(x = dataset$HEIGHT, y = dataset$WEIGHT), 
              color = "grey", 
              linetype = 2, 
              se=F,
              formula = y ~ x) + 
  labs(x = "Height", y = "Weight", color = "MBTI group")
```

```{r}
contingency_table <- table(dataset$HEIGHTgroup, dataset$IE)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Ekstroverstnost nema vete sa visinom.

```{r}
contingency_table <- table(dataset$WEIGHTgroup, dataset$JP)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Prosuđivanje/opažanje nema veze sa visinom.



## Tip ličnosti na temelju pojedinih karakteristika

```{r}

model <- lm(formula = dataset$J ~ dataset$HEIGHT + dataset$SEX + dataset$AGE)
summary(model)

model <- lm(formula = dataset$P ~ dataset$HEIGHT + dataset$SEX + dataset$AGE)
summary(model)

model <- lm(formula = dataset$P ~ dataset$HEIGHT + dataset$WEIGHT + dataset$SEX + dataset$AGE + dataset$ACTIVITY_LEVEL)
summary(model)

model <- lm(formula = dataset$J ~ dataset$HEIGHT + dataset$WEIGHT + dataset$SEX + dataset$AGE + dataset$ACTIVITY_LEVEL)
summary(model)

model <- lm(formula = dataset$J ~ dataset$HEIGHT + dataset$WEIGHT + dataset$SEX + dataset$AGE + dataset$ACTIVITY_LEVEL + dataset$PAIN_1 + dataset$PAIN_2 + dataset$PAIN_3 + dataset$PAIN_4)
summary(model)

probs1 <- predict(model, newdata = dataset, type = "response")

model <- lm(formula = dataset$P ~ dataset$HEIGHT + dataset$WEIGHT + dataset$SEX + dataset$AGE + dataset$ACTIVITY_LEVEL + dataset$PAIN_1 + dataset$PAIN_2 + dataset$PAIN_3 + dataset$PAIN_4)
summary(model)

probs2 <- predict(model, newdata = dataset, type = "response")
slova <- ifelse(probs1>probs2, "J", "P")
vrijednosti <- ifelse(slova == substr(dataset$MBTI, 4, 4), 1, 0)
uk <- sum(vrijednosti)/length(vrijednosti)

```
***

# Zaključak


