---
title: "MBTI dataset transformation and analysis"
author: "Vedran Moškov, Lucija Runjić, Borna Josipović, Lana Bartolović"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r setup, include=FALSE, warning=F}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(magrittr)
library(gridExtra)
library(nortest)
library(leaps)
```

```{r, echo=F}
rm(list = ls()) # uklanjanje svih varijabli iz okoline
```

```{r, echo=F}
source("../Rscripts/utils.R")
```

***

# Motivacija i opis problema

Istražujemo povezanost između osobnosti, dobivene kroz MBTI test, i fizičkih karakteristika poput držanja tijela, težine i visine. Kroz proučavanje pitanja kao što su "Kako tipovi ličnosti utječu na način držanja?" i "Postoje li razlike u tjelesnoj težini ili visini između različitih tipova ličnosti?" analizom ovih podataka, nastojimo bolje razumjeti veze između mentalnog i fizičkog aspekta individualnosti.

***

# Učitavanje i uređivanje podatkovnog skupa

## Učitavanje i proučavanje podatkovnog skupa 

Učitavamo podatkovni skup u varijablu "dataset".
```{r, message=F}
dataset <- read_csv("../data/MBTI.csv")
```

Proučavamo podatkovni skup kako bi ga znali urediti na način da nam je lakše raditi s njim kasnije.
```{r}
head(dataset)
tail(dataset)
glimpse(dataset)
```

## Uređivanje podataka podatkovnog skupa

Faktoriziramo i modificiramo stupce "SEX", "ACTIVITY LEVEL", "MBTI", "POSTURE"  kako bismo kasnije mogli lakše grupirati podatke i bolje ih analizirati.
```{r}
dataset$SEX <- as.factor(dataset$SEX)
dataset$`ACTIVITY LEVEL` <- as.factor(dataset$`ACTIVITY LEVEL`)
dataset$`ACTIVITY LEVEL` <- factor(
  dataset$`ACTIVITY LEVEL`, levels = c("Low", "Moderate", "High")
  )
dataset$MBTI <- as.factor(dataset$MBTI)
dataset$POSTURE <- as.factor(dataset$POSTURE)
dataset$POSTURE <- factor(dataset$POSTURE, levels = c("A", "B", "C", "D"), 
                          labels = c("idealno", "kifoza/lordoza", "ravna leđa", "nagnuto"))
```

Uklonit ćemo prva dva stupca podatkovnog skupa obzirom da su jedinstveni identifikatori te nam ne pomažu u analizi.
```{r}
dataset$...1 <- NULL
dataset$`S No` <- NULL
```

Preimenovat ćemo stupce "ACTIVITY LEVEL", "PAIN 1", "PAIN 2", "PAIN 3" i "PAIN 4" radi jednostavnosti.
```{r}
colnames(dataset)[5] <- "ACTIVITY_LEVEL"
colnames(dataset)[6] <- "PAIN_1"
colnames(dataset)[7] <- "PAIN_2"
colnames(dataset)[8] <- "PAIN_3"
colnames(dataset)[9] <- "PAIN_4"
```

Pretvorit ćemo podatke u stupcima "HEIGHT" i "WEIGHT" u centimentri i kilograme.
```{r}
dataset$HEIGHT <- round(dataset$HEIGHT * 2.54, 1)
dataset$WEIGHT <- round(dataset$WEIGHT * 0.45359237, 1)
```


Dodat ćemo neke nove stupce pomoću kojih ćemo grupirati podatke u manje grupe kako bismo ih mogli bolje analizirati.
```{r}
dataset$GROUP <- as.factor(color(dataset$MBTI)) 
dataset$IS_ACTIVE <- as.factor(
  ifelse(dataset$ACTIVITY_LEVEL == "Low", "Inactive", "Active")
  )
dataset$IE <- as.factor(substring(dataset$MBTI, 1, 1))
dataset$SN <- as.factor(substr(dataset$MBTI, 2, 2))
dataset$TF <- as.factor(substr(dataset$MBTI, 3, 3))
dataset$JP <- as.factor(substr(dataset$MBTI, 4, 4))
```


Ovako naš podatkovni skup izgleda nakon uređivanja njegovih podataka.
```{r}
head(dataset)
tail(dataset)
glimpse(dataset)
```


***
# Analiza podatkovnog skupa

## Provjera normalnosti numeričkih varijabli
```{r}
qqnorm(dataset$AGE, main = "QQ Plot of AGE variable")
qqline(dataset$AGE, col = "red", lwd = 2)
```
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
```{r}
qqnorm(dataset$HEIGHT, main = "QQ Plot of HEIGHT variable")
qqline(dataset$HEIGHT, col = "red", lwd = 2)
```
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
```{r}
qqnorm(dataset$WEIGHT, main = "QQ Plot of WEIGHT variable")
qqline(dataset$WEIGHT, col = "red", lwd = 2)
```
Iz grafova možemo zaključiti da su varijable AGE, HEIGHT i WEIGHT normalno distribuirane.
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
Pogledajmo konkretne p-vrijednosti Shapiro-Wilkovog testa normalnosti.
```{r}
shapiro.test(dataset$AGE)
```
Uz p-value od 0.068 uz razinu značajnosti od 0.2 odbacujemo nultu hipotezu i zaključujemo da varijabla AGE nije normalno distribuirana.

```{r}
shapiro.test(dataset$HEIGHT)
```
Za varijablu HEIGHT također zaključujemo da nije normalno distribuirana.

```{r}
shapiro.test(dataset$WEIGHT)
```
Za varijablu WEIGHT Shapiro-Wilkov test normalnosti nam daje p-vrijednost od 0.81 uz razinu značajnosti od 0.2, što znači da ne možemo odbaciti nultu hipotezu i zaključujemo da je varijabla WEIGHT normalno distribuirana.
\
Iako podaci nisu normalni osim što histogrami donekle nalikuju na normalnu distribuciju, pozivamo se na robusnost T-testa i HI^2-testa te ih ipak provodimo na podacima uz pretpostavku da su podaci nezavisni stoga ćemo nad rezultatima tih testova i donositi zaključke

## Veza između tipa ličnosti i načina držanja

U našem podatkovnom skupu imamo stupce "POSTURE" i "MBTI".

Stupac "POSTURE" poprima vrijednosti:

```{r}
ggplot(dataset, aes(x = POSTURE, fill = POSTURE)) +
  geom_bar() +
  scale_fill_ordinal() + 
  labs(x = "Posture", fill = "Posture", y = "Count")
```

Imamo 4 klase načina držanja: idealno, kifoza/lordoza, ravna leđa, nagnuto.
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
Stupac "MBTI" poprima vrijednosti:
```{r}
ggplot(dataset, aes(x = MBTI, fill = MBTI)) + 
  geom_bar() + 
  scale_fill_ordinal() + 
  theme(axis.text.x = element_text(angle = 45)) + 
  labs(y = "Count")
```                                                                                      
[Razlikujemo 16 vrsta tipova osobnosti](https://www.16personalities.com/personality-types).
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
```{r}
ggplot(dataset, aes(x = GROUP, fill = GROUP)) + 
  geom_bar() + 
  scale_fill_ordinal() + 
  labs(x = "Group", fill = "Group", y = "Count")
```
Tih 16 tipova osobnosti možemo podijeliti u 4 manje grupe kao što je prikazano na grafu iznad.


Provest ćemo hi kvadrat test za kategorijske podatke gdje ćemo proučavati stupce "POSTURE" i "IE" (introvert/ekstrovert) podatkovnog okvira. Pomoću funkcije "check_expected" provjeravamo imamo li uvjete za provedbu testa na temelju dobivenih vrijednosti u našoj kontingencijskoj tablici (vraća TRUE ako su uvjeti za provedbu testa zadovoljeni).
```{r}
contingency_table <- table(dataset$POSTURE, dataset$IE)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Na temelju rezultata testa zaključujemo da ekstrovertnost ima veze s načinom držanja.

Isti postupak ćemo ponoviti i za raspoznavanje/intuiciju, razmišljanje/osjećanje te produđivanje/opažanje.


```{r}
contingency_table <- table(dataset$POSTURE, dataset$SN)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Na temelju rezultata testa zaključujemo da raspoznavanje/intuicija nemaju veze s načinom držanja.

```{r}
contingency_table <- table(dataset$POSTURE, dataset$TF)
contingency_table
check_expected(contingency_table)
```
```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Na temelju rezultata testa zaključujemo da razmišljanje/osjećanje nemaju veze sa načinom držanja.

```{r}
contingency_table <- table(dataset$POSTURE, dataset$JP)
contingency_table
check_expected(contingency_table)
```

```{r}
chisq <- chisq.test(contingency_table)
chisq
```
Na temelju rezultata testa zaključujemo da prosuđivanje/opažanje ima veze sa načinom držanja.
\
\
\
\
\
\
\
\
\
\
\



## Veza između fizičke aktivnosti i razine ekstrovertiranosti

Fizičku aktivnost nam predstavlja stupac "ACTIVITY_LEVEL":
```{r}
ggplot(dataset, aes(x = IS_ACTIVE, fill = IS_ACTIVE)) + 
  geom_bar() + 
  scale_fill_ordinal() + 
  labs(x = "Activity level", fill = "Activity level", y = "Count")
```
Prema ovom grafu ljude dijelimo u fizički aktivne i one neaktivne.
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
Za koeficijent ekstrovertnosti imamo stupac sa nazivom "E":
```{r}
ggplot(dataset, aes(x = E, fill = E > I)) + geom_bar() + 
  scale_fill_ordinal() + 
  labs(x = "Extroversion", fill = "Extrovert", y = "Count")
```
Na grafu vidimo raspodjelu ljudi koji imaju veći koeficijent ekstrovertnosti od koeficijenta introvertnosti.

Provest ćemo hi kvadrat test za kategorijske podatke gdje ćemo proučavati stupce "IS_ACTIVE" (stupac koji mjeri razinu aktivnosti osobe) i "IE" (introvert/ekstrovert) podatkovnog okvira.
```{r}
contingency_table <- table(dataset$IS_ACTIVE, dataset$IE)
contingency_table
check_expected(contingency_table)
```
```{r, warning=F}
chisq <- chisq.test(contingency_table)
chisq
```
Na temelju rezultata testa zaključujemo da ne postoji veza između fizičke aktivnosti i ekstroverstnosti.
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\


## Razlika u visini/težini obzirom na tip ličnosti

U našem podatkovnom skupu imamo stupce "WEIGHT", "HEIGHT" i "GROUP" (stupac u kojem je 16 tipova osobnosti raspoređeno u 4 grupe) čija se međusobna raspodjela vidi na sljedećem grafu:

```{r}
ggplot(dataset, aes(x = dataset$HEIGHT, y = dataset$WEIGHT, color = dataset$GROUP)) + 
  geom_point() + 
  stat_smooth(method = lm, 
              inherit.aes = F, 
              aes(x = dataset$HEIGHT, y = dataset$WEIGHT), 
              color = "grey", 
              linetype = 2, 
              se=F,
              formula = y ~ x) + 
  labs(x = "Height", y = "Weight", color = "MBTI group")
```

Primijenit ćemo analizu varijance (ANOVA) na naš podatkovni skup kako bismo usporedili srednje vrijednosti visine i težine za četiri grupe osobnosti.

Prvo ćemo to učiniti za visinu.
```{r}
model <- aov(HEIGHT ~ GROUP, data = dataset)
summary(model)
```
Obzirom na p-vrijednost od 0.47 ne odbacujemo nultu hipotezu. To sugerira da nema dovoljno dokaza za zaključak da postoje značajne razlike u prosječnoj visini između četiri skupine osobnosti.

Zatim ćemo isto provesti i za težinu.
```{r}
model <- aov(WEIGHT ~ GROUP, data = dataset)
summary(model)
```
Isto kao i u slučaju sa visinom, obzirom na p-vrijednost od 0.208 ne odbacujemo nultu hipotezu te zaključujemo da ne postoje značajne razlike u prosječnoj težini između četiri skupine osobnosti.





## Tip ličnosti na temelju pojedinih karakteristika

U ovom zadatku pokušavamo predvidjeti tip ličnosti na temelju pojedinih karakteristika.
Nismo mogli izračunati točnu vezu s MBTI tipom osobnosti jer je to diskretna varijabla, pa smo umjesto nje pokušavali predvidjeti koeficijente za pojedino svojstvo (npr. ekstrovertnost, intuitivnost, itd.) koristeći linearnu regresiju i uspoređivanjem dobivenih koeficijenata za isto svojstvo, u našem primjeru za J (prosuđivanje) i P (opažanje). Osoba spada u kategoriju J ili P ovisno o tome koji je koeficijent (predviđan linearnom regresijom) veći. Najprije je bilo potrebno testirati više modela linearne regresije, tj. odabrati koje regresore koristiti u modelu. Za pojedine modele smo izračunali R^2 vrijednost, koja nam govori koliko dobro model objašnjava varijabilnost podataka. Model s najvećom R^2 vrijednosti je najbolji model. Nakon što smo odabrali najbolji model, izračunali smo koeficijente za J i P, te smo na temelju njih odredili tu kategoriju.

```{r}
print("Prvi model za J i P karakteristike")
model <- lm(formula = dataset$J ~ dataset$HEIGHT + 
              dataset$SEX + 
              dataset$AGE
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova J prvim modelom", r_squared))

model <- lm(formula = dataset$P ~ dataset$HEIGHT + 
              dataset$SEX + 
              dataset$AGE
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova P prvim modelom", r_squared))

print("Drugi model za J i P karakteristike")
model <- lm(formula = dataset$J ~ dataset$HEIGHT + 
    dataset$WEIGHT + 
    dataset$SEX + 
    dataset$AGE + 
    dataset$ACTIVITY_LEVEL
  )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova J drugim modelom", r_squared))

model <- lm(formula = dataset$P ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              dataset$AGE + 
              dataset$ACTIVITY_LEVEL
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova P drugim modelom", r_squared))

print("Treci model za J i P karakteristike")
model <- lm(formula = dataset$J ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              dataset$AGE + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova J trecim modelom", r_squared))

model <- lm(formula = dataset$P ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              dataset$AGE + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova P trecim modelom", r_squared))
```
Vidimo kako je najprikladniji ispao treći model jer ima najveću R kvadrat vrijednost. Testirajmo točnost modela
```{r}
model <- lm(formula = dataset$J ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              dataset$AGE + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
probs1 <- predict(model, newdata = dataset, type = "response")

model <- lm(formula = dataset$P ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              dataset$AGE + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
probs2 <- predict(model, newdata = dataset, type = "response")

slova <- ifelse(probs1>probs2, "J", "P")
vrijednosti <- ifelse(slova == substr(dataset$MBTI, 4, 4), 1, 0)
uk <- sum(vrijednosti)/length(vrijednosti)

print(paste("Točnost", uk))
```

Kod procjene spada li osoba u kategoriju J ili P, dobili smo točnost od 0.6289, što je zadovoljavajuće. Ovo je dobar rezultat s obzirom na to da je naš model bio jednostavan, tj. nije sadržavao puno regresora, a i podaci su bili dosta neujednačeni, tj. određenih osobnosti nije bilo željene količine. 

Možemo ponoviti testiranje za još jednu karaktristiku, npr. razmišljanje i osjećanje

```{r}
print("Prvi model za F i T karakteristike")
model <- lm(formula = dataset$F ~ dataset$HEIGHT + 
              dataset$SEX + 
              dataset$AGE
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova F prvim modelom", r_squared))

model <- lm(formula = dataset$T ~ dataset$HEIGHT + 
              dataset$SEX + 
              dataset$AGE
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova T prvim modelom", r_squared))

print("Drugi model za F i T karakteristike")
model <- lm(formula = dataset$F ~ dataset$HEIGHT +
              dataset$WEIGHT + 
              dataset$SEX + 
              log(dataset$AGE) + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 +
              dataset$PAIN_4
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova F drugim modelom", r_squared))

model <- lm(formula = dataset$T ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              log(dataset$AGE) + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova T drugim modelom", r_squared))

print("Treci model za F i T karakteristike")
model <- lm(formula = dataset$F ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              dataset$AGE + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 + 
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova F trecim modelom", r_squared))

model <- lm(formula = dataset$T ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX +
              dataset$AGE +
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 +
              dataset$PAIN_2 + 
              dataset$PAIN_3 +
              dataset$PAIN_4
            )
model_summary <- summary(model)
r_squared <- model_summary$r.squared
print(paste("R kvadrat za predikciju slova T trecim modelom", r_squared))

```
Drugi model se pokazuje kao najbolji, testiramo

```{r}
model <- lm(formula = dataset$F ~ dataset$HEIGHT + 
              dataset$WEIGHT + 
              dataset$SEX + 
              log(dataset$AGE) + 
              dataset$ACTIVITY_LEVEL + 
              dataset$PAIN_1 + 
              dataset$PAIN_2 +
              dataset$PAIN_3 + 
              dataset$PAIN_4
            )
model_summary <- summary(model)
probs1 <- predict(model, newdata = dataset, type = "response")

model <- lm(formula = dataset$T ~ dataset$HEIGHT +
              dataset$WEIGHT +
              dataset$SEX +
              log(dataset$AGE) +
              dataset$ACTIVITY_LEVEL +
              dataset$PAIN_1 + 
              dataset$PAIN_2 +
              dataset$PAIN_3 +
              dataset$PAIN_4)

model_summary <- summary(model)
probs2 <- predict(model, newdata = dataset, type = "response")

slova <- ifelse(probs1>probs2, "F", "T")
vrijednosti <- ifelse(slova == substr(dataset$MBTI, 3, 3), 1, 0)
uk <- sum(vrijednosti)/length(vrijednosti)

print(paste("Točnost", uk))
```
Dobivena je točnost 0.7010


## Je li postotak ekstrovertnih ljudi isti kod ljudi iznad i ispod 45 godina

Kako bismo testirali je li postotak ekstroverata isti kod mladjih i starijih ljudi, koristit ćemo Z-test za dvije proporcije, uz alfa=0.05, a hipoteze postavljamo ovako
H0 : postotak ekstroverata je isti neovisno o godinama (p1 - p2 = 0)
H1 : postotak ekstroverata se razlikuje ovisno o godinama (p1 - p2 != 0)

```{r}
subset_result <- subset(dataset, AGE < 46 & substr(MBTI, 1, 1) == "E")
Eyoung <- nrow(subset_result)
total_group1 <- sum(dataset$AGE <= 45)

subset_result <- subset(dataset, AGE > 45 & substr(MBTI, 1, 1) == "E")
Eold <- nrow(subset_result)
total_group2 <- sum(dataset$AGE > 45)

# Perform the z-test for proportions
z_test_result <- prop.test(c(Eyoung, Eold),
                           c(total_group1, total_group2),
                           alternative = "two.sided")

# Print the result
print(z_test_result)
```
Iz polja p-value koji je veći od 0.05 zaključujemo kako na temelju ovih podataka nemamo razloga sumnjati u H0 te ju s toga ne odbacujemo.
***

# Zaključak

(---prazan prostor za zaključak---)


